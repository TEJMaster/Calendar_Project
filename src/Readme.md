#Software Design Phase 2
## Authors:
- Chenxu Wang
- Kevin Sun
- Yifei Sun
- Xiangyu Tu
- Rilong Zhang
- Tony Liang-Zhi Gui
- Andrea Radic

The UML diagrams for each package are packageNameUML.pdf, which are generated by intelliJ.

Please make sure the working directory is the phase2 folder. The main method is in the DemoMain file in the default 
package, the program runs through the main method.

All the required .csv files should be placed in the Data package. These are the csv files which store all the 
information of saved Data. For example, calendar.csv stores all the information of saved calendars. 

####In order to run the program successfully, you need to download external libraries for openCSV, Apache Commons Lang and javaMail.
####You can download javax.mail.jar at: https://javaee.github.io/javamail/
####You can download opencsv-5.5.1.jar at: https://sourceforge.net/projects/opencsv/files/latest/download
####You can download commons-lang3-3.11.jar at: https://mvnrepository.com/artifact/org.apache.commons/commons-lang3/3.11
Please then add these jar files to your libraries.

In case you can not use the email function properly, if exception raised:
javax.net.ssl.SSLHandshakeException: No appropriate protocol, please find java.security on your computer, remove SSLv3 
from the line "jdk.tls.disabledAlgorithms=MD5, SSLv3, ... < 2048" and the line "jdk.tls.disabledAlgorithms=MD5, SSLv3,
... < 1024"
## Basic Features:

### Users
- We have four types of users: Trial Users, Regular Users, Admin Users, Temporary Users.
  - Trial Users - Designed to be a one-time user who does not have a password. Trial users' changes on calendars and
    activities will not be saved after they log out, however, messages to admin will be saved.
  - Regular Users - Designed to be a regular user who can create/view calendars, change password, undelete calendars, 
    add friends, send message to admins and check responses from admins.
  - Admin Users - Designed to have all the functions a regular user have, except sending message to admins and check
    responses from admins are changed to respond messages and check messages sent to admins. On top of that, Admin users
    have additional options such as modifying template, creating welcome message, creating accounts for other admin 
    users,freeze accounts that have not logged in for long time, suspend other non-admin accounts, and view/change any
    creations by other users.
  - Temporary Users - Temporary Users are a type of user who can only log in for 30 days after registered. A temporary 
    user can be a temporary regular user or a temporary admin user.
    
### Calendars
- We have three types of calendars: DateCalendar (Yearly calendar), Timetable, and Monthly Calendar.
  - DateCalendar - This is a calendar that can stores activities on any date this year (the year when the user is using
    the program based on his local time).
  - TimeTable - This is a weekly calendar that can store activities on any day of the week (e.g., Monday, Tuesday...).
  - Monthly Calendar - This is a monthly calendar that can store activities either on this month or any month based on 
    the user's input.
    
    
## List of Features Implemented In Phase 2

### Admins can modify particular question in template
- Admins have the option to modify template, for example, when there is a typo in the template. During the process,
admins will be asked to enter which question they wish to edit and edit the particular question instead of typing a
  list of questions to represent the new template. The modification will be updated after admin users log out and choose
  to save their changes.
  
### Monthly Calendar Template (user interact with it differently)
- We introduced a new template for calendars (monthly calendar template), which asks user's questions to create a
calendar for one month. User has the option to create a default monthly calendar for this month based on his answer for
  the first question of the template. If he chooses to create a default one, the rest of the questions will not be asked,
  which is different compared to the previous templates for calendars.
  
### Send temporary password through email if forgot password
- Added EmailSender which can send emails using smtp. Therefore, there is a restriction for the username as email can
only be successfully sent if the recipient is a gmail account. This is also why we implemented the restriction for our
  username during the registration process. The temporary password is in the format of capital letter A + the part of 
  username before @gmail + number 123. If the user does not change password after logging in, the password will be set
  as the temporary password. Users will be informed to enter f to send email when they enter password during the log-in 
  process if they forgot their password.

### Temporary User
- Added a new type of temporary user which can be created for regular and admin users. This temporary user account is 
  only available for 30 days and will expire meaning the user can no longer login after 30 days. (To test this, create 
  a temporary user account and move the clock on your local pc to 30 days later, there should be a message saying your 
  temporary account is expired when you try to log in)
  
### Admin can suspend users
- There is a new option in the Admin's main menu to allow an admin user to suspend a user, which means the chosen 
  user is not allowed to log in for a number of days chosen by the admin. If the user tries to log in during the 
  suspension period, a message will pop up saying your account has been suspended and stops the user from logging in. 
  (The suspension works by calculating the difference between the current day, and the day that the user got 
  suspended, if the difference in days is large or equal to the number of days chosen by the admin, the user may 
  log in. For example, if the user got suspended on August 15th for 1 day. He may log in on August 16th.
  
### Admin can edit/view all creations & can freeze accounts & create accounts for other Admins
- Admin users now have a lot more power compared to phase 1, now admin users can see and select any calendars in the 
  program to view or edit no matter what type of calendar it is. After they select the calendar, they would enter the 
  calendar menu with full access to all of the features listed like change the type of the calendar or delete the
  calendar. On the other hand, the admin can also freeze any other users that have at least a number of days of 
  inactivity that the admin can choose in the main menu. The freezing works by looking at the last login date of a user. 
  A frozen user will automatically be unfreezed the next time when he logs in and during the freezing period of a user, 
  his creations can not be viewed or changed by any user except for admins.  Admins can also create accounts for other
  admin users in the main menu.

### Admin can set welcome message
- There is another new option for admins that allows them to set the welcome message that would display when any user 
  logs in.
  
### Messaging System
- There is a new messaging system between users and admins. For regular users, there is an option in the regular user’s 
  main menu that allows the user to send messages to admins and check responses from the admins. For admins, they can
  respond to a message by inputting a username from a list of usernames that have sent messages. If the admin responds 
  to the message sent by users, the message will be marked as resolved.  (notice that since we are using commas to 
  separate pieces of info in the message, do not use commas in these messages to avoid errors).

### Elaborate Password System & Password/Username Validator
- We added a password validator to check the strength of the password. There are three types of passwords which are 
  “good”, “weak” and “too weak”. Password is good if it contains at least 1 capital letter, at least one lowercase 
  letter, at least 1 number, at least one special character and is at least 10 characters long. Password is weak if it 
  contains at least one lowercase letter, at least one number," and is at least 8 characters long. Otherwise, the
  password is considered too weak. You need to have at least a weak password in order to create an account. We also 
  added a username validator to check if the username entered during the registration process is valid (valid if it's
  a gmail account).
  
### Friend-only Calendars and Collaborative Creations
- In terms of regular user features, we added a new type of calendar which is friend only and only friends of the 
  creator of the calendar has access to viewing and editing it. A user can add another user as their friend in the main 
  menu. For private and public calendars, there is an editor list to keep track of who can edit the calendar. Private 
  calendars only have the creator as the only editor while anyone who has editing rights can add another editor to the 
  public calendar’s editor list in the calendar menu. This enables the collaborative creation between users. On the 
  other hand, admin users can edit any calendars.
  
### Editing History and Undo-feature
- There is a new editing history for each calendar to keep track of who and when an editor added or deleted activities.
  Users can view it in the calendar menu. An undo option is also present to undo the most recent changes in activities 
  or reverse to the previous type of the calendar. For these undo features, we decided that the user can keep undoing 
  the undo until he makes a new change. The right to undo is granted to users that can edit the calendar depending which 
  type of the calendar it is. Furthermore, when a user logs out he can on longer reverse the type or activity since we 
  are not saving the corresponding attributes.
  
### Undelete (add back) deleted calendars
- There is an option to undelete deleted calendars by looking at the deleted calendar list in the calendar manager.
  Since we are not saving the deleted calendar and only the creator or admin can delete calendars, all the calendars 
  inside deleted calendar attribute can be reversed and re added to the program. However, when the user logs out, he can 
  on longer undelete the deleted calendars.

### View by Category / Importance
- When viewing the activities either by date or check all activities . There are two new options to view activities by 
  categories and importance. When viewing by categories, the user will first input a category and all the activity that 
  has the same category will be displayed either for activities of a certain day or in all activities. On the other 
  hand, if the user chose to view by importance, the user can see all the activities that are important or not important 
  depending on the user’s choice.
  

## Design Pattern
###Factory Design Pattern
CalendarFactory is used to encapsulate the constructors when making instances of subclasses 
(in this case, dateCalendar/monthlyCalendar and timeTable) for an abstract class (Calendar). With this design, 
classes that create a certain type of calendar based on user input do not need to know which type of the calendar it is 
creating, which improves encapsulation and abstraction.

###Dependency Injection Pattern
We used dependency injection design pattern in multiple places in our program to avoid hard dependencies. For example,
in the use case classes like user manager and calendar manager. We need the output from the information reader which is 
a gateway class to initialize its attributes from the csv. Instead of having dependencies, we are creating an 
information reader object outside of these use case classes and passing the object inside the use case classes so that 
now the constructor works perfectly and there are no dependencies between use case classes and gateway classes.

###Iterator Design Pattern
We applied Iterator Design Pattern when we design savor. Since we do save work using csv, we need to iterate Template's 
QuestionList when we save them. However, with the goal of decreasing dependency in mind, we applied Iterator pattern, so
that we only initiate an Iterator at the beginning of usage, and we will not need to reveal structure of Template and Template
manager, just an abstract.

###Strategy Design Pattern
Validator is an interface for UseNameValidator and PasswordValidator, which is considered as a strategy pattern.
For classes with common properties, but apply different algorithms, an interface can be used to encapsulate the 
algorithms as they are now isolated.

###Observer Design Pattern
We applied Observer Design Pattern when we design messaging System. Unlike other information that are stored to file only
after the user log out, Messages are stored immediately since they are read in a more direct way. AdminMessage has a attribute
called state that represents whether his message has been responded, and it will be updated as soon as being responded. This
leads to our idea of "one action trigger another", not to mention we have the saving feature being called at the same time
as well. Thus, we introduce the observer pattern and let two observers watch adminMessage and respondMessage. They will update
states of message after responding and reload them in the file so that they are always up-to-date. This observer enables 
us to decrease dependency between messaging system and other classes and decrease responsibility as well.

###Façade Design pattern
Although we did not directly use the facade design pattern, we used a similar idea as facade when we were writing the
main menu of users. The facade design pattern creates a facade class that creates classes that each interact with one 
actor and delegate responsibility to these classes. On the other hand, in the main menu class it also creates multiple 
classes like calendar creator, modifying template system, messaging system and so on that each has a single
responsibility and depending on the input of the user, it interacts with these classes to delegate each feature. 


##Design Decisions & Things improved from Phase 1
- Changed all the use of array lists into lists which are more abstract to keep the attribute as abstract as possible.
- In phase 1, our saver and read functions are scattered all over the place which would violate the single
  responsibility principle. In phase2, we moved them to two separate gateway classes where one of them saves all the 
  information, and the other reads all the info.
- We removed the transition program and deleted or moved its method to other controllers. In all the methods, we are 
  no longer creating an instance of objects inside each method but to use attributes or dependency injection.
- We are using the returns statements to return to the main menu and changed all the use of static methods. 
- Added a cancel button r to cancel the creation process and return to menu during adding activity or creating a 
  calendar. 
-Deleted unused methods and extracted duplicate code into methods. Also use csv reader to read csv to have consistent 
  use of saver and reader.
- TrialUser is the parent class of RegularUser; RegularUser is the parent class of TemporaryUser.
- Monthly Calendar is in fact constructed as a date calendar since they have similar features and properties, but with
  fewer keys in the hashmap of dates-to-activityIDs (dates being the keys).
- Although Trial Users' changes on calendars and activities will not be saved after logging out, if they send messages
  to Admins during log-in process, it will be updated because of the observer. We have this on purpose as it is easier and
  more efficient for businesses to use trial users to test and report bugs to Admins by sending messages.
